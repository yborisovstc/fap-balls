<?xml version="1.0" ?>

<!-- Specification of FAP environment for fap-balls demo application -->

<!DOCTYPE  caeenv SYSTEM "/home/yborisov/projects/fap/git/fapws/src/objspec.dtd" > 

<!-- TODO [YB] It is to hard to specify the balls in the ares, especially to link them. We need to ball factory within the area -->

<caeenv>
    <object type="area" id="Area" quiet="yes">
	<object type="none" id="ball" quiet="yes">
	    <logspec  event="cre"> <logdata id="new"/> </logspec>

	    <state type="StPointF" id="Coord"  access="Out" transf="trans_coord" init="(0,0)"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
		<!-- Inputs from itself -->
		<inp id="CoordS"/> <inp id="InpVS"/> <inp id="MassS"/> <inp id="RadS"/> <inp id="TranspS"/>
		<!-- External inputs -->
		<inp id="Coord.*"/> <inp id="Rad.*"/> <inp id="Transp.*"/> <inp id="InpV.*"/>
	    </state>

	    <state type="StInt" id="Mass"  access="Inp" init="100"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
	    </state>

	    <state type="StUint32" id="Rad"  access="Inp" init="30"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
	    </state>

	    <state type="StVectF" id="InpV" access="Inp" transf="trans_inpv" init="0"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
		<!-- Inputs from itself -->
		<inp id="CoordS"/> <inp id="MassS"/> <inp id="RadS"/> <inp id="InpVS"/> <inp id="TranspS"/> <inp id="MovedS"/> <inp id="McPosS"/> 
		<!-- External inputs -->
		<inp id="Coord.*"/> <inp id="Mass.*"/> <inp id="Rad.*"/> <inp id="Transp.*"/> <inp id="InpV.*"/>
	    </state>

	    <!-- TODO [YB] McPos is used in borded not as mouse but as area rect. Consider renaming the state -->
	    <!-- Current position of mouse -->
	    <state type="StPoint" id="McPos"  access="Inp" init="0"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
		<inp id="McPos"/> 
	    </state>

	    <state type="StBool" id="Moved"  access="Inp" transf="trans_moved" init="0"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
		<inp id="LbDownS"/> <inp id="HookedPermS"/> <inp id="CoordS"/> <inp id="RadS"/> <inp id="McPosS"/> 
	    </state>

	    <state type="StBool" id="Transp"  access="Inp" init="0"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
	    </state>

	    <state type="StInt" id="LbDown"  access="Inp" init="0"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
		<inp id="LbDown"/> 
	    </state>

	    <state type="StBool" id="HookedPerm"  access="Inp" init="0"> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
	    </state>

	    <!-- TODO [YB] Input "MassS" is required only for condition for coord trans but not for transition itsels. Reconsider. -->
	    <conn state="Coord"> <dep inp="CoordS" conn="Coord"/> <dep inp="InpVS" conn="InpV"/> <dep inp="MassS" conn="Mass"/> <dep inp="RadS" conn="Rad"/> 
		<dep inp="TranspS" conn="Transp"/></conn>
	    <conn state="InpV"> <dep inp="CoordS" conn="Coord"/> <dep inp="RadS" conn="Rad"/> <dep inp="TranspS" conn="Transp"/> <dep inp="InpVS" conn="InpV"/>
		<dep inp="MovedS" conn="Moved"/> <dep inp="McPosS" conn="McPos"/> <dep inp="MassS" conn="Mass"/> </conn>
	    <conn state="Moved"> <dep inp="LbDownS" conn="LbDown"/> <dep inp="HookedPermS" conn="HookedPerm"/>  
		<dep inp="CoordS" conn="Coord"/> <dep inp="RadS" conn="Rad"/> <dep inp="McPosS" conn="McPos"/> </conn>

	</object> <!-- ball -->

	<!-- Area Initializer. It does second phase creation of area - creates borders -->
	<object type="none" id="Area_Initializer">
	    <state type="StInt" id="Borders_count" access="Reg" transf="trans_borders_count" init="0">
		<!--
		<logspec event="tran"> <logdata id="dep"/> </logspec> 
		-->
		<!-- Counts the borders created -->
		<!-- Rectangle of the area. It uses to create borders matching the rectangle -->
		<inp id="Rect"/> <inp id="Self"/> 
	    </state>
	</object>

	<!-- Ball creator. Creates the ball and adds it to area 
	     Inputs Coord, Mass, Rad - parameters of the created ball
	     Ready - status of ball creation
	     -->
	<object type="none" id="Ball_creator" quiet="yes">
	    <state type="StPointF" id="Coord"  access="Inp" init="(0,0)"> </state>
	    <state type="StInt" id="Mass"  access="Inp" init="100"> </state>
	    <state type="StUint32" id="Rad"  access="Inp" init="30"> </state>
	    <state type="StBool" id="Start"  access="Inp" transf="trans_ball_creation_start" init="0"> 
		<inp id="Ready"/> 
	    </state>
	    <state type="StBool" id="Ready"  access="Out" transf="trans_ball_creation_ready" init="1"> 
		<logspec event="tran"> <logdata id="dep"/> </logspec> 
		<logspec event="upd"> <logdata id="new"/> </logspec> 
		<inp id="Ready"/> 
		<inp id="Start"/> 
		<inp id="Coord"/> 
		<inp id="Mass"/> 
		<inp id="Rad"/>
	    </state>

	    <conn state="Start">
		<dep inp="Ready" conn="Ready"/>
	    </conn>

	    <conn state="Ready">
		<dep inp="Ready" conn="Ready"/>
		<dep inp="Start" conn="Start"/>
		<dep inp="Coord" conn="Coord"/>
		<dep inp="Mass" conn="Mass"/>
		<dep inp="Rad" conn="Rad"/>
	    </conn>
	</object> <!-- Ball_creator -->

	<object type="ball" id="ball_1"> <state mut="Change" id="Mass" init="500"/> <state mut="Change" id="Rad" init="40"/> 
	    <state mut="Change" id="Coord" init="(50,50)"/> </object>

	<object type="ball" id="ball_2"> <state mut="Change" id="Mass" init="200"/> <state mut="Change" id="Rad" init="30"/> 
	    <state mut="Change" id="Coord" init="(50,50)"/> </object>

	<!--
	<object type="Ball_creator" id="ball_creator_1" >
	    <state mut="Change" id="Coord" init="(110, 30)"/>
	    <state mut="Change" id="Mass" init="40"/>
	    <state mut="Change" id="Rad" init="20"/>
	    <state mut="Change" id="Start" init="1"/>
	</object>
	-->

	<!--
	<object type="Ball_creator" id="ball_creator_2" >
	    <state mut="Change" id="Coord" init="(120, 30)"/>
	    <state mut="Change" id="Mass" init="6"/>
	    <state mut="Change" id="Rad" init="15"/>
	    <state mut="Change" id="Start" init="1"/>
	</object>
	-->


	<state type="StRect" id="Rect" access="Inp" init="0">
	    <logspec event="upd"> <logdata id="new"/> </logspec> </state>

	<state type="StInt" id="LbDown" access="Inp" init="0">
	    <logspec event="upd"> <logdata id="new"/> </logspec> </state>

	<state type="StPoint" id="McPos"  access="Inp" init="0"> 
	    <logspec event="upd"> <logdata id="new"/> </logspec> </state>

	<!-- Ball_1 connections -->
	<conn state="ball_1.Coord"> <dep inp="Coord.0" conn="ball_2.Coord"/> <dep inp="Rad.0" conn="ball_2.Rad"/> <dep inp="Transp.0" conn="ball_2.Transp"/>
	    <dep inp="InpV.0" conn="ball_2.InpV"/></conn>
	<conn state="ball_1.InpV"> <dep inp="Coord.0" conn="ball_2.Coord"/> <dep inp="Rad.0" conn="ball_2.Rad"/> <dep inp="Transp.0" conn="ball_2.Transp"/>
	    <dep inp="InpV.0" conn="ball_2.InpV"/> <dep inp="Mass.0" conn="ball_2.Mass"/> </conn>
	<conn state="ball_1.LbDown"> <dep inp="LbDown" conn="LbDown"/></conn>
	<conn state="ball_1.McPos"> <dep inp="McPos" conn="McPos"/></conn>

	<!-- Ball_2 connections -->
	<conn state="ball_2.Coord"> <dep inp="Coord.0" conn="ball_1.Coord"/> <dep inp="Rad.0" conn="ball_1.Rad"/> <dep inp="Transp.0" conn="ball_1.Transp"/>
	    <dep inp="InpV.0" conn="ball_1.InpV"/></conn>
	<conn state="ball_2.InpV"> <dep inp="Coord.0" conn="ball_1.Coord"/> <dep inp="Rad.0" conn="ball_1.Rad"/> <dep inp="Transp.0" conn="ball_1.Transp"/>
	    <dep inp="InpV.0" conn="ball_1.InpV"/> <dep inp="Mass.0" conn="ball_1.Mass"/> </conn>
	<conn state="ball_2.LbDown"> <dep inp="LbDown" conn="LbDown"/></conn>
	<conn state="ball_2.McPos"> <dep inp="McPos" conn="McPos"/></conn>

	<!-- -->
	<conn state="Area_Initializer.Borders_count"> <dep inp="Rect" conn="Rect"/> <dep inp="Self" conn="Area_Initializer.Borders_count"/></conn>

    </object> <!-- area -->
</caeenv>

